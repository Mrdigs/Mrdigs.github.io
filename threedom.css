/*
 * Copyright (c) 2020 Darren Scott - All Rights Reserved
 *
 * This program is distributed under GPL Version 3 in the hope that
 * it will be useful, but WITHOUT ANY WARRANTY.
 */

/*
  top, right, bottom, left is the css standard
  so for planes, I recommend front, top, right, back, bottom, left
*/

/*
:root {
  --x-rotation: 0;
  --y-rotation: 0;
  --z-rotation: 0;
  --x2-rotation: 0;
  --y2-rotation: 0;
  --z2-rotation: 0;
  --x-translation: 0;
  --y-translation: 0;
  --z-translation: 0;
}
*/

:root {
  /*
  GRRR, CANT GET THIS WORKING RIGHT
  --height: var(--height, var(--width));
  --depth: var(--depth, var(--width));
  */
}

.three-d, .three-d > *:not(.three-d) {

  --x-rotation: 0;
  --y-rotation: 0;
  --z-rotation: 0;
  --x2-rotation: 0;
  --y2-rotation: 0;
  --z2-rotation: 0;
  --x-translation: 0;
  --y-translation: 0;
  --z-translation: 0;
  --x2-translation: 0;
  --y2-translation: 0;
  --z2-translation: 0;

  /* these 2 are invalid */
  /*
  --width: var(width);
  --height: var(height);
  */
  /* this messes up the inheritance */
  /* --depth: 0; */

  /*
    It'd be great to be able to assume height and depth default
    to width so no need to specify, but here breaks things...
  */
  /*
  --height: var(--height, var(--width));
  --depth: var(--depth, var(--width));
  */

  /* Many thanks to the author of this gist for the trig functions */
  /* https://gist.github.com/stereokai/7666bfe93929b14c2dced148c79e0e97 */

  --angle: 0;
  --pi: 3.141592653589793238;
  --rad: calc(var(--angle) * var(--pi) / 180);
  --radsq: calc(var(--rad) * var(--rad));

  --sin-term1: var(--rad);
  --sin-term2: calc((var(--radsq) * var(--rad)) / 6);
  --sin-term3: calc((var(--radsq) * var(--radsq) * var(--rad)) / 120);
  --sin-term4: calc((var(--radsq) * var(--radsq) * var(--radsq) * var(--rad)) / 5040);
  --sin-term5: calc((var(--radsq) * var(--radsq) * var(--radsq) * var(--radsq) * var(--rad)) / 362880);
  --sin: calc(var(--sin-term1) - var(--sin-term2) + var(--sin-term3) - var(--sin-term4) + var(--sin-term5));

  --cos-term1: 1;
  --cos-term2: calc(var(--radsq) / 2);
  --cos-term3: calc((var(--radsq) * var(--radsq)) / 24);
  --cos-term4: calc((var(--radsq) * var(--radsq) * var(--radsq)) / 720);
  --cos-term5: calc((var(--radsq) * var(--radsq) * var(--radsq) * var(--radsq)) / 40320);
  --cos: calc(var(--cos-term1) - var(--cos-term2) + var(--cos-term3) - var(--cos-term4) + var(--cos-term5));

  --tan: calc(var(--sin) / var(--cos));
}

.three-d > *:not(.three-d) {
  --width: inherit;
  --height: inherit;
  --depth: inherit;
}

.three-d {
  width: var(--width);
  height: var(--height);
  /* transform-style: preserve-3d; */
  /* margin: auto; */
}

.three-d.outlined, .three-d.outlined .three-d, .three-d.outlined .three-d.object > *, .three-d.outlined.object > * {
  outline: 1px dotted gray;
}

.three-d.space {
  perspective: 200vmax;
  display: flex;
  align-items: center;
  justify-content: center;
}

.three-d.private.space {
  overflow: hidden;
}

.three-d.inline.space {
  display: inline-flex;
  vertical-align: middle;
}

figure.three-d {
    margin-block-start: initial;
    margin-block-end: initial;
    margin-inline-start: initial;
    margin-inline-end: initial;
}

.three-d.space * {
  transform-style: preserve-3d;
}

.three-d.nobackface > * {
  backface-visibility: hidden;
}

.three-d.reflective.space {
  -webkit-box-reflect: below 0 url('data:image/svg+xml;charset=utf-8;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4NCjxzdmcgd2lkdGg9IjIxMG1tIiBoZWlnaHQ9IjI5N21tIiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCAyMTAgMjk3IiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOmNjPSJodHRwOi8vY3JlYXRpdmVjb21tb25zLm9yZy9ucyMiIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4NCjxkZWZzPg0KPGxpbmVhckdyYWRpZW50IGlkPSJhIiB4MT0iMTA3LjY3IiB4Mj0iMTA3LjQ1IiB5MT0iMzkzLjc0IiB5Mj0iMTQ0LjM4IiBncmFkaWVudFRyYW5zZm9ybT0ibWF0cml4KDEuMzYxMiAwIDAgMSAtMzkuMjQ1IDApIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSI+DQo8c3RvcCBzdG9wLWNvbG9yPSIjMDYwMDAwIiBvZmZzZXQ9IjAiLz4NCjxzdG9wIHN0b3AtY29sb3I9IiMwNjAwMDAiIHN0b3Atb3BhY2l0eT0iMCIgb2Zmc2V0PSIxIi8+DQo8L2xpbmVhckdyYWRpZW50Pg0KPC9kZWZzPg0KPG1ldGFkYXRhPg0KPHJkZjpSREY+DQo8Y2M6V29yayByZGY6YWJvdXQ9IiI+DQo8ZGM6Zm9ybWF0PmltYWdlL3N2Zyt4bWw8L2RjOmZvcm1hdD4NCjxkYzp0eXBlIHJkZjpyZXNvdXJjZT0iaHR0cDovL3B1cmwub3JnL2RjL2RjbWl0eXBlL1N0aWxsSW1hZ2UiLz4NCjxkYzp0aXRsZS8+DQo8L2NjOldvcms+DQo8L3JkZjpSREY+DQo8L21ldGFkYXRhPg0KPHJlY3QgeD0iLS4zMjUxOSIgeT0iMS4wNDA5IiB3aWR0aD0iMjEwLjM5IiBoZWlnaHQ9IjI5Ni42OSIgZmlsbD0idXJsKCNhKSIgZmlsbC1ydWxlPSJldmVub2RkIiBzdHJva2Utd2lkdGg9Ii4zMDg2OCIvPg0KPC9zdmc+');
}

.three-d.object, .three-d.carousel {
    /* position: relative; */
}

.three-d.object > *, .three-d.cylinder > *, .three-d.carousel > *, .three-d.wheel > * {
  display: flex;
  align-items: center;
  justify-content: center;
  position: absolute;
  /* copied to below to allow objects themselves to have easy */
  /* transforms */
  /*
  transform:
    rotateX(var(--x-rotation))
    rotateY(var(--y-rotation))
    rotateZ(var(--z-rotation))
    rotateX(var(--x2-rotation))
    rotateY(var(--y2-rotation))
    rotateZ(var(--z2-rotation))
    translate3d(
      var(--x-translation), var(--y-translation), var(--z-translation)
    );
  */
  width: inherit;
  height: inherit;
  /* This messes with making faces of objects 3d */
  /* like a card for a carousel face to have back and front */
  /* check the impact before uncommenting */
  /* overflow: hidden; */
}

.three-d, .three-d.object > *, .three-d.cylinder > *, .three-d.carousel > *, .three-d.wheel > * {
  transform:
    rotateX(var(--x-rotation))
    rotateY(var(--y-rotation))
    rotateZ(var(--z-rotation))
    translate3d(
      var(--x2-translation), var(--y2-translation), var(--z2-translation)
    )
    rotateX(var(--x2-rotation))
    rotateY(var(--y2-rotation))
    rotateZ(var(--z2-rotation))
    translate3d(
      var(--x-translation), var(--y-translation), var(--z-translation)
    );
}

/*
.three-d.shaded.object > * {
  box-shadow: inset 0px 0px 100px #00000075;
}
*/

/*
  front, top, right, back, bottom, left
*/

.three-d.shaded.object > * {
  filter: brightness(var(--brightness, 1));
}

.three-d.shaded.object > *:nth-child(2) {
  --brightness: 1.2; /* top */
}

.three-d.shaded.object > *:nth-child(3) {
  --brightness: 0.9; /* right */
}

.three-d.shaded.object > *:nth-child(4) {
  --brightness: 0.8; /* back */
}

.three-d.shaded.object > *:nth-child(5) {
  --brightness: 0.8; /* bottom */
}

.three-d.shaded.object > *:nth-child(6) {
  --brightness: 1.1; /* left */
}

.three-d.seated.object > *:nth-child(5):nth-last-child(2) {
  /* the 5th, bottom plane has a shadow when seated */
  box-shadow: -7px -7px 20px 0px #000000b5;
}

/*
 See http://lea.verou.me/2011/01/styling-children-based-on-their-number-with-css3/
*/

/* two faces */

.three-d.object > *:nth-child(2):nth-last-child(1) {
  /* the 2nd face */
  --y-rotation: 180deg;
}

/* four faces */

.three-d.object > *:first-child:nth-last-child(4),
.three-d.object > *:first-child:nth-last-child(4) ~ * {
  --angle: 60;
  height: calc(var(--height) * var(--sin));
  clip-path: polygon(50% 0, 0 100%, 100% 100%);
  transform-origin: 0 0;
}

/*
  front, top, right, back, bottom, left
*/

.three-d.object > *:nth-child(1):nth-last-child(4) {
  /* the 1st face */
  --x-rotation: 19.5deg;
  /*
  --z-translation: -62px;
  */
}

.three-d.object > *:nth-child(2):nth-last-child(3) {
  /* the 2nd face */
  transform-origin: 100% 0;
  --x2-rotation: 19.5deg;
  --y-rotation: 120deg;
  /*
  --z-translation: -62px;
  --x-translation: 200px;
  */
  --z-translation: -82px;
  --x-translation: 149px;
  --y-translation: -29px;
}

.three-d.object > *:nth-child(3):nth-last-child(2) {
  /* the 3rd face */
  transform-origin: 0 100%;
  --x-rotation: 90deg;
  --z-translation: 11px;
  --y-rotation: 180deg;
  /*
  --x-translation: -200px;
  */
  --x-translation: -200px;
  --z-translation: -10px;
  --y-translation: 58px;
}

.three-d.object > *:nth-child(4):nth-last-child(1) {
  /* the 4th face */
  --x2-rotation: 19.5deg;
  --y-rotation: -120deg;
  /*
  --z-translation: -62px;
  --x-translation: -200px
  */
  --z-translation: -82px;
  --x-translation: -149px;
  --y-translation: -29px;
}

/* five faces */

.three-d.object > *:nth-child(1):nth-last-child(5) {
  /* the 1st face */
}

.three-d.object > *:nth-child(2):nth-last-child(4) {
  /* the 2nd face */
}

.three-d.object > *:nth-child(3):nth-last-child(3) {
  /* the 3rd face */
}

.three-d.object > *:nth-child(4):nth-last-child(2) {
  /* the 4th face */
}

.three-d.object > *:nth-child(5):nth-last-child(1) {
  /* the 5th face */
}

/* six faces */

/*
  top, right, bottom, left is the css standard
  so for planes, I recommend front, top, right, back, bottom, left
*/

.three-d.object > *:nth-child(6):nth-last-child(1) {
  /* the 6th face */
  --z-translation: calc((var(--width) / 2) + ((var(--width) - var(--depth)) / -2));
  --y-rotation: 270deg;
  width: var(--depth);
}

.three-d.object > *:nth-child(5):nth-last-child(2) {
  /* the 5th face */
  --z-translation: calc((var(--height) / 2) + ((var(--height) - var(--depth)) / 2));
  --x-rotation: 270deg;
  height: var(--depth);
}

.three-d.object > *:nth-child(4):nth-last-child(3) {
  /* the 4th face */
  --z-translation: calc(var(--depth) / 2);
  --y-rotation: 180deg;
}

.three-d.object > *:nth-child(3):nth-last-child(4) {
  /* the 3rd face */
  --z-translation: calc((var(--width) / 2) + ((var(--width) - var(--depth)) / 2));
  --y-rotation: 90deg;
  width: var(--depth);
}

.three-d.object > *:nth-child(2):nth-last-child(5) {
  /* the 2nd face */
  --z-translation: calc((var(--height) / 2) - ((var(--height) - var(--depth)) / 2));
  --x-rotation: 90deg;
  height: var(--depth);
}

.three-d.object > *:nth-child(1):nth-last-child(6) {
  /* the 1st face */
  --z-translation: calc(var(--depth) / 2);
}

/* CYLINDER */
/* ======== */

/*
  I have to break the model of the order of faces for this one:
  to allow it to have an arbitrary number of faces around the
  vertical axis, the top has to be the first face and the
  bottom has to be the last.

  Other than that, it's pretty similar to the carousel.
*/

.three-d.cylinder > * {
  --angle: calc(360 / (var(--faces) - 2) / 2);
  --face-width: calc(var(--sin) * (var(--width) / 1));
  --radius: calc((var(--face-width) / 2) / var(--tan));
}

.three-d.cylinder > *:first-child {
  height: calc(var(--radius) * 2);
  clip-path: var(--cross-section);
  --z-translation: var(--radius);
  --x-rotation: 90deg;
}

.three-d.cylinder > *:not(:first-child):not(:last-child) {
  width: var(--face-width);
  --face-angle: calc(1deg * (var(--angle) * 2));
  --y2-rotation: calc(var(--face-angle) * (var(--face) + 1));
  --x2-translation: calc(var(--face-width) / 2);
  --z-translation: var(--radius);
}

.three-d.cylinder > *:last-child {
  height: calc(var(--radius) * 2);
  clip-path: var(--cross-section);
  --z-translation: calc(var(--height) - var(--radius));
  --x-rotation: 270deg;
}

/* WHEEL */
/* ===== */

.three-d.wheel > * {
  --angle: calc(360 / var(--faces) / 2);
  --face-angle: calc(1deg * (var(--angle) * 2));
  --x-rotation: calc(var(--face-angle) * (var(--face) - 1));
  --z-translation: calc((var(--height) / 2) / var(--tan));
}

/* CAROUSEL */
/* ======== */

.three-d.carousel > * {
  --angle: calc(360 / var(--faces) / 2);
  --face-angle: calc(1deg * (var(--angle) * 2));
  --y-rotation: calc(var(--face-angle) * (var(--face) - 1));
  --z-translation: calc((var(--width) / 2) / var(--tan));
}

/* CAROUSEL WRAPPING */
/* ================= */

.three-d.wrapped.carousel > * {
  background-size: cover;
  background-position-x: calc(var(--width) * (1 - var(--face)));
}

/* GENERAL PURPOSE FACE COUNTERS */
/* ============================= */

.three-d > * {
  --face: 0;
  --faces: 0;
}

.three-d > *:nth-child(1) {
  --face: 1;
}

.three-d > *:first-child:nth-last-child(1),
.three-d > *:first-child:nth-last-child(1) ~ * {
  --faces: 1;
}

.three-d > *:nth-child(2) {
  --face: 2;
}

.three-d > *:first-child:nth-last-child(2),
.three-d > *:first-child:nth-last-child(2) ~ * {
  --faces: 2;
}

.three-d > *:nth-child(3) {
  --face: 3;
}

.three-d > *:first-child:nth-last-child(3),
.three-d > *:first-child:nth-last-child(3) ~ * {
  --faces: 3;
}

.three-d > *:nth-child(4) {
  --face: 4;
}

.three-d > *:first-child:nth-last-child(4),
.three-d > *:first-child:nth-last-child(4) ~ * {
  --faces: 4;
}

.three-d > *:nth-child(5) {
  --face: 5;
}

.three-d > *:first-child:nth-last-child(5),
.three-d > *:first-child:nth-last-child(5) ~ * {
  --faces: 5;
}

.three-d > *:nth-child(6) {
  --face: 6;
}

.three-d > *:first-child:nth-last-child(6),
.three-d > *:first-child:nth-last-child(6) ~ * {
  --faces: 6;
}

.three-d > *:nth-child(7) {
  --face: 7;
}

.three-d > *:first-child:nth-last-child(7),
.three-d > *:first-child:nth-last-child(7) ~ * {
  --cross-section: polygon(0% 38.31%, 50% 0%,100% 38.31%,80.86% 100%,19.14% 100%);
  --faces: 7;
}

.three-d > *:nth-child(8) {
  --face: 8;
}

.three-d > *:first-child:nth-last-child(8),
.three-d > *:first-child:nth-last-child(8) ~ * {
  --cross-section: polygon(25% 0%, 75% 0%,100% 50%,75% 100%,25% 100%,0% 50%);
  --faces: 8;
}

.three-d > *:nth-child(9) {
  --face: 9;
}

.three-d > *:first-child:nth-last-child(9),
.three-d > *:first-child:nth-last-child(9) ~ * {
  --faces: 9;
}

.three-d > *:nth-child(10) {
  --face: 10;
}

.three-d > *:first-child:nth-last-child(10),
.three-d > *:first-child:nth-last-child(10) ~ * {
  --faces: 10;
}

.three-d > *:nth-child(11) {
  --face: 11;
}

.three-d > *:first-child:nth-last-child(11),
.three-d > *:first-child:nth-last-child(11) ~ * {
  --faces: 11;
}

.three-d > *:nth-child(12) {
  --face: 12;
}

.three-d > *:first-child:nth-last-child(12),
.three-d > *:first-child:nth-last-child(12) ~ * {
  --faces: 12;
}

.three-d > *:nth-child(13) {
  --face: 13;
}

.three-d > *:first-child:nth-last-child(13),
.three-d > *:first-child:nth-last-child(13) ~ * {
  --faces: 13;
}

.three-d > *:nth-child(14) {
  --face: 14;
}

.three-d > *:first-child:nth-last-child(14),
.three-d > *:first-child:nth-last-child(14) ~ * {
  --faces: 14;
}

.three-d > *:nth-child(15) {
  --face: 15;
}

.three-d > *:first-child:nth-last-child(15),
.three-d > *:first-child:nth-last-child(15) ~ * {
  --faces: 15;
}

.three-d > *:nth-child(16) {
  --face: 16;
}

.three-d > *:first-child:nth-last-child(16),
.three-d > *:first-child:nth-last-child(16) ~ * {
  --faces: 16;
}

.three-d > *:nth-child(17) {
  --face: 17;
}

.three-d > *:first-child:nth-last-child(17),
.three-d > *:first-child:nth-last-child(17) ~ * {
  --faces: 17;
}

.three-d > *:nth-child(18) {
  --face: 18;
}

.three-d > *:first-child:nth-last-child(18),
.three-d > *:first-child:nth-last-child(18) ~ * {
  --faces: 18;
}

/* ANIMATIONS */
/* ========== */

.three-d.rotating {
  --rx: 1; --ry: 1; --rz: 1; --from: 0deg; --to: 360deg;
  animation: rotating 10s linear infinite;
}

.three-d.spinning {
  --rx: 0; --rz: 0; --from: 360deg; --to: 0deg;
  animation: rotating 10s linear infinite;
}

.three-d.rolling {
  --ry: 0; --rz: 0; --from: 360deg; --to: 0deg;
  animation: rotating 10s linear infinite;
}

.three-d.extra.slowly {
  animation-duration: 60s;
}

.three-d.slowly {
  animation-duration: 30s;
}

.three-d.quickly {
  animation-duration: 5s;
}

.three-d.extra.quickly {
  animation-duration: 2s;
}

@keyframes rotating {
  from {
    transform: rotate3d(var(--rx, 1), var(--ry, 1), var(--rz, 1), var(--from, 0deg));
  }
  to {
    transform: rotate3d(var(--rx, 1), var(--ry, 1), var(--rz, 1), var(--to, 360deg));
  }
}
